<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Bio‑Vault | BalanceChain | TVM</title>

  <!-- PWA / viewport -->
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="theme-color" content="#15264d">
  <link rel="manifest" href="./manifest.json">

  <!-- SEO -->
  <meta name="description"
        content="The next‑generation digital money vault—pegged, stable, audit‑proof. 1 TVM = 1 USD. Powered by BalanceChain technology.">

  <!-- Service‑Worker -->
  <script>
    if ('serviceWorker' in navigator) {
      window.addEventListener('load', () => {
        navigator.serviceWorker.register('./sw.js')
          .then(reg => console.log('Service Worker registered:', reg.scope))
          .catch(err => console.error('Service Worker registration failed:', err));
      });
    }
  </script>

  <!-- ethers.js -->
  <script src="https://cdn.jsdelivr.net/npm/ethers@5.7.umd/dist/ethers.min.js"></script>

  <!-- Full CSS -->
  <style>
    html,body{background:linear-gradient(to left,#2f4979,#15264d);color:#fff;font-family:'Segoe UI',Tahoma,Geneva,Verdana,sans-serif;margin:0;padding:20px;min-height:100vh;display:flex;flex-direction:column;align-items:center;text-align:center;scroll-behavior:smooth;}
    h1,h2,h3{margin:10px 0}.hidden{display:none!important}button{background:#2258c4;color:#fff;padding:10px 20px;border:none;border-radius:5px;font-size:16px;margin:5px;cursor:pointer;transition:background .3s,box-shadow .18s;outline:none;}button:focus{box-shadow:0 0 0 3px #ffe164cc;}button:hover{background:#144180}#lockedScreen{margin-top:50px}#lockedScreen #enterVaultBtn{margin-top:20px}#vaultUI{max-width:900px;width:100%;margin-top:20px}.section{margin:20px auto;max-width:800px;width:85%}.input-field{padding:10px;margin:10px 5px;border:none;border-radius:4px;width:45%;max-width:300px;font-size:16px}#transactionTable{width:100%;border-collapse:collapse;background:#fff;color:#000;margin-top:20px;border-radius:5px;overflow:hidden}#transactionTable th,#transactionTable td{padding:10px;border-bottom:1px solid #ccc;word-wrap:break-word}#transactionTable th{background:#f3f4f6}#bioLineUTCContainer{display:flex;justify-content:space-around;align-items:center;background:rgba(255,255,255,.1);padding:15px 30px;border-radius:10px;font-size:18px;margin-bottom:20px;flex-wrap:wrap}#catchInSection,#catchOutSection{background:rgba(255,255,255,.1);padding:20px;border-radius:10px;margin:20px auto;box-shadow:0 4px 6px rgba(0,0,0,.1);max-width:600px}#catchInBtn{background:#10b981}#catchInBtn:hover{background:#059669}#catchOutBtn{background:#f97316}#catchOutBtn:hover{background:#ea580c}.modal,.popup{background:rgba(0,0,0,.82);position:fixed;top:0;left:0;width:100vw;height:100vh;z-index:10010;display:none;justify-content:center;align-items:center;flex-direction:column;animation:fadeIn .22s}@keyframes fadeIn{from{opacity:0;transform:scale(.96)}to{opacity:1;transform:scale(1)}}.modal-content,.popup-content{background:#fff;color:#0e2242;padding:32px 22px;border-radius:11px;max-width:440px;min-width:260px;box-shadow:0 8px 44px rgba(0,0,0,.25);text-align:left;position:relative;font-size:17px;line-height:1.6;font-family:inherit;animation:scaleIn .18s}@keyframes scaleIn{from{opacity:0;transform:scale(.91)}to{opacity:1;transform:scale(1)}}.modal-content h2,.modal-content h3,.popup-content h3{margin-top:0;color:#174ca7}.modal-close{position:absolute;top:11px;right:16px;background:none;border:none;color:#174ca7;font-size:25px;cursor:pointer;z-index:2}.modal-nav{display:flex;gap:6px;margin-bottom:18px;justify-content:center;flex-wrap:wrap}.modal-nav button{background:#e9edfc;color:#1a3167;padding:5px 13px;border-radius:5px;border:none;margin:0;font-size:15px;transition:background .22s,color .22s;font-weight:bold}.modal-nav button.active,.modal-nav button:hover{background:#ffe164;color:#193356}.modal-features,.explainer-features{display:flex;flex-wrap:wrap;gap:10px;margin-bottom:10px}.modal-feature,.explainer-feature{background:#1a2d50;border-radius:7px;padding:7px 14px;font-size:1rem;min-width:110px;color:#ffe164;text-align:center}.explainer-feature{flex:1 1 160px}.modal-list{padding-left:18px;margin:9px 0}.modal-tip{color:#08b0a4;background:#f3f4f6;padding:7px 12px;border-radius:5px;display:inline-block;margin:9px 0 0;font-size:.96rem}.explainer-section{background:rgba(255,255,255,.12);border-radius:10px;margin:20px 0 0;padding:22px 32px;color:#fff;text-align:left;max-width:720px;width:96%;box-shadow:0 4px 24px rgba(0,0,0,.07)}.explainer-section h2{color:#ffe164;font-size:2rem;margin-bottom:10px}.explainer-links{margin:18px 0 0;display:flex;flex-wrap:wrap;gap:8px}.explainer-links button{background:none;color:#fff;border:none;font-weight:bold;text-decoration:underline;cursor:pointer;margin:0 10px 0 0;padding:0;font-size:1.08em}.explainer-links .audit-btn{color:#ffe164;font-weight:bold;background:none;border:2px solid #ffe164;border-radius:6px;padding:5px 13px;margin-left:7px}.onboarding-tip{color:#7fffd4;background:#0d2b43;padding:7px 12px;border-radius:5px;display:inline-block;margin:12px 0;font-size:1rem}.help-fab{position:fixed;bottom:22px;right:22px;z-index:10050;background:#ffe164;color:#15264d;border-radius:50%;border:none;width:62px;height:62px;box-shadow:0 6px 20px #0004;font-size:32px;cursor:pointer;font-weight:bold;transition:background .22s;outline:none}.help-fab:hover,.help-fab:focus{background:#fff0b2;box-shadow:0 6px 26px #0005}.toast{position:fixed;bottom:38px;left:50%;transform:translateX(-50%);background:#10b981;color:#fff;font-weight:bold;border-radius:7px;padding:15px 30px;z-index:10070;font-size:17px;min-width:170px;text-align:center;box-shadow:0 4px 24px #14418045;animation:fadeIn .27s;display:none}.toast.toast-error{background:#ef4444}@media(max-width:768px){.explainer-section,.modal-content,.popup-content{padding:12px 2vw;font-size:15px}#transactionTable th:nth-child(2),#transactionTable td:nth-child(2){max-width:60px;word-wrap:break-word}.input-field{width:70%}#bioLineUTCContainer{width:80%;flex-direction:column}}@media(max-width:480px){#transactionTable{font-size:12px}button{padding:8px 16px;font-size:14px}.explainer-features,.modal-features,.modal-nav{flex-direction:column}.explainer-feature,.modal-feature,.modal-nav button{font-size:.98rem}.modal-content,.popup-content{min-width:120px}.help-fab{width:50px;height:50px;font-size:24px}.toast{padding:9px 8vw;font-size:14px}}
  </style>
</head>

<body>
  <!-- ============================= HERO ============================= -->
  <div class="explainer-section" id="explainer">
    <h2>BalanceChain: Digital Money. Redefined.</h2>
    <div><b>1 TVM = 1 USD — Forever.</b></div>
    <div class="explainer-features">
      <div class="explainer-feature">Pegged & Stable</div>
      <div class="explainer-feature">Audit‑Proof</div>
      <div class="explainer-feature">Human‑Effort Backed</div>
      <div class="explainer-feature">Instant P2P & Private</div>
      <div class="explainer-feature">Works Offline</div>
      <div class="explainer-feature">No Mining / Banks</div>
    </div>
    <div class="explainer-links">
      <button onclick="openModal('whitepaperModal')">White Paper</button>
      <button onclick="openModal('faqModal')">FAQ</button>
      <button onclick="openModal('supportModal')">Support</button>
      <button onclick="openModal('communityModal')">Community</button>
      <button onclick="openModal('legalModal')">Legal</button>
      <button class="audit-btn" onclick="openModal('auditModal')">Audit Peg</button>
    </div>
    <div class="onboarding-tip" id="onboardingTip" style="display:none">
      <b>Tip:</b> Back up your vault now. Lose passphrase + file = funds gone forever.
    </div>
  </div>

  <!-- Floating help FAB -->
  <button class="help-fab" aria-label="Open FAQ" onclick="openModal('faqModal')">?</button>

  <!-- ========================== ALL MODALS ========================== -->
  <!-- 1. Onboarding -->
  <div id="onboardingModal" class="modal"><div class="modal-content" tabindex="0">
    <button class="modal-close" onclick="closeModal('onboardingModal')">&times;</button>
    <div class="modal-nav">
      <button onclick="modalNav('onboardingModal',0)" class="active">Welcome</button>
      <button onclick="modalNav('onboardingModal',1)">How It Works</button>
      <button onclick="modalNav('onboardingModal',2)">Security</button>
    </div>
    <div class="modal-onboarding-page">
      <h2>Welcome</h2>
      <p>This vault brings you the world’s first cryptographically pegged dollar:<br><b>TVM = USD.</b></p>
      <button onclick="modalNav('onboardingModal',1)">Next &rarr;</button>
    </div>
    <div class="modal-onboarding-page hidden">
      <h2>How It Works</h2>
      <ul class="modal-list">
        <li>Your balance is split into 12 000 serial‑indexed segments.</li>
        <li>Spend one ➜ unlock one (capped 3/day · 30/mo · 90/yr).</li>
        <li>Every segment has a full cryptographic audit trail.</li>
      </ul>
      <button onclick="modalNav('onboardingModal',2)">Next &rarr;</button>
    </div>
    <div class="modal-onboarding-page hidden">
      <h2>Security</h2>
      <ul class="modal-list">
        <li><b>Write down</b> your vault passphrase.</li>
        <li><b>Export</b> a backup file now.</li>
        <li>No central recovery — you hold the keys.</li>
      </ul>
      <button onclick="closeModal('onboardingModal')">Got it</button>
    </div>
  </div></div>

  <!-- 2. White Paper -->
  <div id="whitepaperModal" class="modal"><div class="modal-content" tabindex="0">
    <button class="modal-close" onclick="closeModal('whitepaperModal')">&times;</button>
    <div class="modal-nav">
      <button onclick="openModal('whitepaperModal')" class="active">White Paper</button>
      <button onclick="openModal('faqModal')">FAQ</button>
      <button onclick="openModal('auditModal')">Audit Peg</button>
      <button onclick="openModal('supportModal')">Support</button>
      <button onclick="openModal('communityModal')">Community</button>
      <button onclick="openModal('legalModal')">Legal</button>
    </div>
    <h2>BalanceChain White Paper (Summary)</h2>
    <div class="modal-features">
      <div class="modal-feature">Pegged 1 USD</div>
      <div class="modal-feature">Audit‑Proof</div>
      <div class="modal-feature">Zero Inflation</div>
    </div>
    <ul class="modal-list">
      <li>TVM’s peg is enforced by protocol mathematics — not faith.</li>
      <li>Every coin is backed by cryptographic proof of human work (SHE).</li>
      <li>No mining, no printing, no central bank.</li>
      <li>Offline first, fully self‑custodial.</li>
    </ul>
    <div class="modal-tip">Need full 40‑page PDF? Email support@shemoney.app</div>
  </div></div>

  <!-- 3. Audit -->
  <div id="auditModal" class="modal"><div class="modal-content" tabindex="0">
    <button class="modal-close" onclick="closeModal('auditModal')">&times;</button>
    <div class="modal-nav">
      <button onclick="openModal('whitepaperModal')">White Paper</button>
      <button onclick="openModal('faqModal')">FAQ</button>
      <button onclick="openModal('auditModal')" class="active">Audit Peg</button>
      <button onclick="openModal('supportModal')">Support</button>
      <button onclick="openModal('communityModal')">Community</button>
      <button onclick="openModal('legalModal')">Legal</button>
    </div>
    <h2>Audit the Peg</h2>
    <p id="auditPegLive">Loading…</p>
    <div class="modal-tip">You can export every coin’s chain of custody — instant on your device.</div>
  </div></div>

  <!-- 4. FAQ -->
  <div id="faqModal" class="modal"><div class="modal-content" tabindex="0">
    <button class="modal-close" onclick="closeModal('faqModal')">&times;</button>
    <div class="modal-nav">
      <button onclick="openModal('whitepaperModal')">White Paper</button>
      <button onclick="openModal('faqModal')" class="active">FAQ</button>
      <button onclick="openModal('auditModal')">Audit Peg</button>
      <button onclick="openModal('supportModal')">Support</button>
      <button onclick="openModal('communityModal')">Community</button>
      <button onclick="openModal('legalModal')">Legal</button>
    </div>
    <h2>FAQ</h2>
    <ul class="modal-list">
      <li><b>TVM peg?</b> 1 TVM = 12 SHE = 1 USD.</li>
      <li><b>Bio‑IBAN?</b> Your private address.</li>
      <li><b>Backup?</b> Passphrase + .vault file mandatory.</li>
      <li><b>Offline?</b> Yes — all proofs local.</li>
      <li><b>On‑chain?</b> Bridge via TVM smart contract.</li>
    </ul>
  </div></div>

  <!-- 5. Support -->
  <div id="supportModal" class="modal"><div class="modal-content" tabindex="0">
    <button class="modal-close" onclick="closeModal('supportModal')">&times;</button>
    <div class="modal-nav">
      <button onclick="openModal('whitepaperModal')">White Paper</button>
      <button onclick="openModal('faqModal')">FAQ</button>
      <button onclick="openModal('auditModal')">Audit Peg</button>
      <button onclick="openModal('supportModal')" class="active">Support</button>
      <button onclick="openModal('communityModal')">Community</button>
      <button onclick="openModal('legalModal')">Legal</button>
    </div>
    <h2>Support</h2>
    <p>Email <b>support@shemoney.app</b> or join Telegram @yourcommunity.</p>
  </div></div>

  <!-- 6. Community -->
  <div id="communityModal" class="modal"><div class="modal-content" tabindex="0">
    <button class="modal-close" onclick="closeModal('communityModal')">&times;</button>
    <div class="modal-nav">
      <button onclick="openModal('whitepaperModal')">White Paper</button>
      <button onclick="openModal('faqModal')">FAQ</button>
      <button onclick="openModal('auditModal')">Audit Peg</button>
      <button onclick="openModal('supportModal')">Support</button>
      <button onclick="openModal('communityModal')" class="active">Community</button>
      <button onclick="openModal('legalModal')">Legal</button>
    </div>
    <h2>Community</h2>
    <p>Discord <a href="https://discord.gg/yourserver" target="_blank" style="color:#2258c4;">discord.gg/yourserver</a><br>
       Telegram <a href="https://t.me/yourcommunity" target="_blank" style="color:#2258c4;">@yourcommunity</a></p>
  </div></div>

  <!-- 7. Legal -->
  <div id="legalModal" class="modal"><div class="modal-content" tabindex="0">
    <button class="modal-close" onclick="closeModal('legalModal')">&times;</button>
    <div class="modal-nav">
      <button onclick="openModal('whitepaperModal')">White Paper</button>
      <button onclick="openModal('faqModal')">FAQ</button>
      <button onclick="openModal('auditModal')">Audit Peg</button>
      <button onclick="openModal('supportModal')">Support</button>
      <button onclick="openModal('communityModal')">Community</button>
      <button onclick="openModal('legalModal')" class="active">Legal</button>
    </div>
    <h2>Legal &amp; Privacy</h2>
    <p>This vault is open‑source. Use at your own risk. No server logs, no personal data collected.</p>
  </div></div>

  <!-- ========================== LOCKED SCREEN ========================== -->
  <div id="lockedScreen">
    <h1>Bio‑Vault</h1>
    <h2>WELCOME TO YOUR VAULT<br>WHERE THE TRUE VALUE OF MONEY IS</h2>
    <button id="enterVaultBtn">Enter Vault</button>
  </div>

  <!-- ========================== PASSPHRASE POPUP ========================= -->
  <div id="passModal" class="modal"><div class="modal-content" tabindex="0">
    <h3 id="passModalTitle">Enter Passphrase</h3>
    <input id="passModalInput"  type="password" placeholder="Passphrase"><br>
    <label id="passModalConfirmLabel" for="passModalConfirmInput" class="hidden">Confirm:</label><br>
    <input id="passModalConfirmInput" type="password" placeholder="Repeat" class="hidden"><br>
    <button id="passModalCancelBtn">Cancel</button>
    <button id="passModalSaveBtn">Save</button>
  </div></div>

  <!-- Lock / Terminate Buttons -->
  <button id="lockVaultBtn" class="hidden">Lock Vault</button>
  <button id="terminateBtn" class="hidden">Terminate Vault</button>

  <!-- ============================= MAIN UI ============================= -->
  <div id="vaultUI" class="hidden">
    <!-- Bio‑IBAN -->
    <div class="section">
      <label>Your Bio‑IBAN</label><br>
      <input id="bioibanInput" class="input-field" placeholder="BIO…" readonly>
      <button id="copyBioIBANBtn">Copy</button>
    </div>

    <!-- Balances -->
    <div class="section">
      <span id="tvmBalance">Balance: 0 TVM</span><br>
      <span id="usdBalance">Equivalent 0 USD</span>
    </div>

    <!-- BonusConstant + UTC -->
    <div id="bioLineUTCContainer">
      <div id="bioLineText">🔄 BonusConstant: 0</div>
      <div id="utcTime">UTC Time: …</div>
    </div>

    <!-- Wallet Address -->
    <div class="section">
      <input id="userWalletAddress" class="input-field" placeholder="0xWallet…">
      <button id="saveWalletBtn">Save Wallet</button>
      <button id="autoConnectWalletBtn">Auto‑Connect</button><br>
      <span id="userWalletLabel">(No wallet set)</span>
    </div>

    <!-- Catch‑In -->
    <div id="catchInSection" class="section">
      <input id="catchInBioCatch" class="input-field" placeholder="Bio‑Catch #">
      <input id="catchInAmount"   class="input-field" type="number" placeholder="Amount (TVM)">
      <button id="catchInBtn">Catch In</button>
    </div>

    <!-- Catch‑Out -->
    <div id="catchOutSection" class="section">
      <input id="receiverBioIBAN" class="input-field" placeholder="Receiver Bio‑IBAN">
      <input id="catchOutAmount"  class="input-field" type="number" placeholder="Amount (TVM)">
      <button id="catchOutBtn">Catch Out</button>
    </div>

    <!-- Transactions -->
    <h3>Transaction History</h3>
    <div class="section">
      <button id="exportBtn">Export CSV</button>
      <button id="exportBackupBtn">Backup Vault</button>
      <button id="exportFriendlyBtn">Mobile Backup</button><br>
      <label>Import .vault: <input type="file" id="importVaultFileInput" accept=".vault"></label>
    </div>
    <table id="transactionTable">
      <thead><tr><th>Bio‑IBAN</th><th>Bio‑Catch</th><th>TVM</th><th>Date/Time</th><th>Status</th></tr></thead>
      <tbody id="transactionBody"></tbody>
    </table>
  </div>

  <!-- Bio‑Catch Popup -->
  <div id="bioCatchPopup" class="popup"><div class="popup-content">
    <h3>Your Bio‑Catch Number</h3>
    <p id="bioCatchNumberText"></p>
    <button id="copyBioCatchBtn">Copy</button>
    <button id="closeBioCatchPopup">Close</button>
  </div></div>

  <!-- Toast -->
  <div id="toast" class="toast"></div>

  <!-- Footer -->
  <div class="section" id="footer">
    &copy; <span id="currentYear"></span> RR.R — for Humanity.
    <script>document.getElementById('currentYear').textContent=new Date().getFullYear();</script>
  </div>

  <!-- ====================== MODAL / TOAST HELPERS ====================== -->
  <script>
    /* modal open/close */
    function openModal(id){ document.querySelectorAll('.modal').forEach(m=>m.style.display='none');
      const m=document.getElementById(id); if(m){ m.style.display='flex'; const f=m.querySelector('[tabindex]'); f&&setTimeout(()=>f.focus(),150);}
      document.body.style.overflow='hidden'; }
    function closeModal(id){ const m=document.getElementById(id); if(m) m.style.display='none'; document.body.style.overflow=''; }
    document.addEventListener('keydown',e=>{ if(e.key==='Escape'){ document.querySelectorAll('.modal').forEach(m=>m.style.display='none'); document.body.style.overflow=''; }});
    function modalNav(modalId,page){ const modal=document.getElementById(modalId);
      if(!modal)return; const pages=modal.querySelectorAll('.modal-onboarding-page'); pages.forEach((p,i)=>p.classList.toggle('hidden',i!==page));
      const nav=modal.querySelectorAll('.modal-nav button'); nav.forEach((b,i)=>b.classList.toggle('active',i===page)); }
    /* Toast */
    function showToast(msg,isErr=false){ const t=document.getElementById('toast'); t.textContent=msg;
      t.className='toast'+(isErr?' toast-error':''); t.style.display='block'; setTimeout(()=>t.style.display='none',3400); }

    /* Onboarding check */
    function showOnboardingIfNeeded(){ if(!localStorage.getItem('vaultOnboarded')){ openModal('onboardingModal'); modalNav('onboardingModal',0); localStorage.setItem('vaultOnboarded','yes'); } }
    function showBackupReminder(){ document.getElementById('onboardingTip').style.display = localStorage.getItem('vaultBackedUp')?'none':''; }
    window.addEventListener('DOMContentLoaded',()=>{ showOnboardingIfNeeded(); showBackupReminder(); });

    /* Live audit peg */
    function refreshPeg(){ const el=document.getElementById('auditPegLive'); if(el) el.textContent=`TVM supply: 10,000 (protocol‑pegged) – ${new Date().toLocaleString()}`; }
    refreshPeg(); setInterval(refreshPeg,30000);
  </script>

  <!-- ====================== SEGMENT LOGIC ====================== -->
  <script type="module" src="main.js"></script>
</body>
</html>
