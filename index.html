<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
  <meta charset="utf‑8">
  <title>Balance‑Chain Vault</title>

  <!-- ▸ Security & PWA meta -->
  <meta http‑equiv="Content‑Security‑Policy"
        content="default-src 'self';
                 connect-src 'self' https://*.ethers.org;
                 script-src 'self';
                 style-src  'self' 'unsafe-inline';
                 img-src    'self' data:;">
  <meta name="viewport"        content="width=device-width,initial-scale=1">
  <meta name="theme-color"     content="#15264d">
  <link rel="manifest"         href="manifest.json">
  <link rel="apple-touch-icon" href="/icons/192.png">

  <!-- ▸ Extracted stylesheet -->
  <link rel="preload"    href="vault.css" as="style">
  <link rel="stylesheet" href="vault.css"
        integrity="sha384-REPLACE_WITH_SRI_HASH"
        crossorigin="anonymous">
</head>
<body>

<!-- ───────────────────────── Locked / Welcome screen ───────────────────── -->
<section id="lockedScreen">
  <h1 data-i18n="welcome.title">Balance‑Chain Vault</h1>
  <button id="openVaultBtn" class="primary" data-i18n="welcome.open">Open</button>
</section>

<!-- ───────────────────────── Vault dashboard ────────────────────────────── -->
<section id="vaultUI" style="display:none">

  <header class="vault‑header">
    <input id="bioibanInput" class="iban" readonly value="">
    <button id="copyBioIBANBtn" title="Copy" data-i18n="common.copy">📋</button>

    <span id="bioLineText"></span>
    <span id="utcTime"></span>
    <button id="rotatePinBtn" class="link" data-i18n="pin.rotate">Rotate PIN</button>
  </header>

  <div class="balance‑box">
    <h2><span id="tvmBalance">Balance: 0 TVM</span></h2>
    <p id="usdBalance">Equivalent 0 USD</p>
    <p id="tvmClaimable"></p>

    <label data-i18n="wallet.address">Wallet address</label>
    <input id="userWalletAddress" autocomplete="off">
    <button id="saveWalletBtn"  data-i18n="wallet.save">Save</button>
    <button id="autoConnectWalletBtn" data-i18n="wallet.connect">Auto‑connect</button>
  </div>

  <!-- ▸ Catch‑Out -->
  <section class="pane">
    <h3 data-i18n="catchout.title">Send (“Catch‑Out”)</h3>
    <input id="receiverBioIBAN" placeholder="Receiver Bio‑IBAN">
    <input id="catchOutAmount"  type="number" min="1" placeholder="Amount">
    <button id="catchOutBtn" data-i18n="catchout.send">Export & Copy</button>
  </section>

  <!-- ▸ Catch‑In -->
  <section class="pane">
    <h3 data-i18n="catchin.title">Receive (“Catch‑In”)</h3>
    <textarea id="catchInBioCatch" rows="4"
              placeholder="Paste the received payload here"></textarea>
    <button id="catchInBtn" data-i18n="catchin.claim">Claim</button>
  </section>

  <!-- ▸ Transactions table -->
  <section class="pane">
    <h3 data-i18n="tx.title">Transactions</h3>
    <table>
      <thead>
        <tr><th>Bio‑IBAN</th><th>Bio‑Catch</th><th>Amt</th><th>Date</th><th>Status</th></tr>
      </thead>
      <tbody id="transactionBody"></tbody>
    </table>
    <p id="txEmptyState" data-i18n="tx.empty">No transactions yet.</p>
    <button id="txPrevBtn">◄</button>
    <button id="txNextBtn">►</button>
    <button id="exportBtn" class="link" data-i18n="tx.export">CSV</button>
  </section>

  <!-- ▸ Backup banner -->
  <div id="onboardingTip" class="banner">
    <strong data-i18n="backup.tip">Back up your vault!</strong>
    <button id="exportBackupBtn"  data-i18n="backup.enc">Encrypted backup</button>
    <button id="exportFriendlyBtn" data-i18n="backup.raw">Friendly .vault</button>
    <input  id="importVaultFileInput" type="file" hidden>
  </div>
</section>

<!-- ───────────────────────── Bio‑Catch popup ────────────────────────────── -->
<div id="bioCatchPopup" class="modal" role="dialog" aria-modal="true"
     aria-labelledby="bioCatchTitle" tabindex="-1">
  <div class="modal-content">
    <h2 id="bioCatchTitle" data-i18n="catchcode.title">Your Bio‑Catch</h2>
    <p id="bioCatchNumberText" class="code">‑‑</p>
    <button id="copyBioCatchBtn" data-i18n="common.copy">Copy</button>
    <button id="closeBioCatchPopup" class="modal-close"
            aria-label="Close">✕</button>
  </div>
</div>

<!-- ───────────────────────── Onboarding modal ───────────────────────────── -->
<div id="onboardingModal" class="modal" role="dialog" aria-modal="true"
     aria-labelledby="onbTitle" tabindex="-1">
  <div class="modal-content">
    <h2 id="onbTitle" data-i18n="onboard.title">Welcome</h2>
    <p data-i18n="onboard.body">Choose a passphrase to create your vault.</p>
    <button class="modal-close primary" data-i18n="common.ok">OK</button>
  </div>
</div>

<!-- ───────────────────────── Unlock modal ──────────────────────────────── -->
<div id="passModal" class="modal" role="dialog" aria-modal="true"
     aria-labelledby="passTitle" tabindex="-1">
  <div class="modal-content">
    <h2 id="passTitle" data-i18n="unlock.title">Unlock Vault</h2>
    <input id="passModalInput" type="password" autocomplete="off"
           placeholder="Passphrase">
    <button id="passModalSaveBtn" class="primary" data-i18n="common.unlock">Unlock</button>
  </div>
</div>

<!-- ───────────────────────── Toast / status bar ────────────────────────── -->
<div id="toast" class="toast" role="status" aria-live="polite"></div>

<!-- ───────────────────────── Scripts ───────────────────────────────────── -->
<script src="main.js" defer></script>
<script>
/* — register SW once everything else loaded — */
if ('serviceWorker' in navigator) {
  window.addEventListener('load', () =>
    navigator.serviceWorker.register('/sw.js'));
}
</script>
</body>
</html>
